Описание интеграции
==================================================================================================

Данный раздел описывает интеграции с системой Картотека обременений(К2)

Сервисы для приема
---------------------------

Сервис приема сведений о просроченной задолженности
_______________________________________________________________

Запрос

.. code-block:: text

POST http://{$k2host}/restapi/services/k2loan_from_eko


.. code-block:: json

	[
		{
			"iban": "KZ000000000000000000",
			"cur": "KZT",
			"debt": 2000000,
			"fullname": "Тестовый Тест Тестович",
			"contract_number": "KD0000000001",
			"dbz_contract_number": "KD0000000001",
			"iinbin": "000000000000",
			"overdue_days": 90,
			"system": "way4"		
		}
		,
		{
		
		}
		,
		{
		
		}
	]


Ответ:

.. code-block:: json

	{
		"error_text":"",
		"error_code":0
	}



"error_code":0 - успешный ответ


Сервис приема статусов входящего платежного требования
_______________________________________________________________

POST http://{$k2host}/restapi/services/k2req_status_from_eko

.. code-block:: json

	{
		"reference": "PTP00000000001",
		"status_code": "PC1"
	}


.. list-table:: Описание полей
   :header-rows: 1

   * - Поле
     - Описание
   * - reference
     - Референс платежного требования
   * - status_code
     - Статус подтверждения	 

.. list-table:: Описание статуса
   :header-rows: 1

   * - Описание статуса
     - код статуса
   * - Принята банком
     - PC1
   * - Принята в картотеку банка
     - PC3
 
Ответ:

.. code-block:: json
	
	{
		"error_text":"",
		"error_code":0
	}


«error_code»:0 - успешный ответ


Сервисы , которые вызываем в АБС
------------------------------------------------------

Получить информацию по клиенту
_______________________________________________________________


GET http://{$abs_get_cli_url}?iinbin=000000000000

.. list-table:: Описание полей
   :header-rows: 1

   * - Поле
     - Описание
   * - iinbin
     - ИИН или БИН клиента

Ответ:

.. code-block:: json
	
	{
		"error_text":"",
		"error_code":0,
		"iinbin": "000000000000",
		"fullname": "850210301899",
		"sectecon": 9,
		"residfl": 1
	}

«error_code»:0 - успешный ответ	
	
Список счетов по клиенту
_______________________________________________________________


GET http://{$abs_get_acc_url}?iinbin=000000000000

.. list-table:: Статусы
   :header-rows: 1

   * - Поле
     - Описание
   * - iinbin
     - ИИН или БИН клиента

Ответ:

.. code-block:: json
	
	{
		"error_text":"",
		"error_code":0,
		"ibans":
		[		
			{
				"iban":"KZ000000000000000000",
				"accountName":"Наименование счета, обычно ФИО",			
				"ps": "2204191",
				"system": "way4",
				"cur": "KZT"
			}
		]

	}
	
«error_code»:0 - успешный ответ	

.. list-table:: Описание полей
   :header-rows: 1

   * - Поле
     - Описание
   * - iban
     - Номер счета
   * - accountName
     - Наименование счета, обычно ФИО
   * - ps
     - План счетов по ГК
   * - system
     - КОД АБС
   * - cur
     - Валюта

Получить выписку по счету на Дату
_______________________________________________________________
	 
Достаточно вернуть 1 строку выписки по предоставлению кредита:

GET http://{$abs_get_acc_stmt_dt_url}?iban=KZ000000000000000000&dt=2020-01-01

.. list-table:: Описание полей
   :header-rows: 1

   * - Поле
     - Описание
   * - iban
     - Номер счета
   * - dt
     - Дата в формате ГГГГ.ММ.ДД

Ответ:

.. code-block:: json

	{
		"error_text": "",
		"error_code": 0,
		"stmt": [
			{
				"purpose": "Предоставление кредита по договору",
				"amount": 900000,
				"cur": "KZT",
				"DC": "D",
				"out_bal": 900000
			}
		]
	}


.. list-table:: Описание полей
   :header-rows: 1
	
   * - Поле
     - Описание
   * - purpose
     - Назначение платежа
   * - amount
     - Сумма
   * - cur
     - Код валюты
   * - DC
     - D -дебет, C - кредит
   * - out_bal
     - Исходящий остаток
	
«error_code»:0 - успешный ответ	

.. list-table:: Описание полей
   :header-rows: 1

   * - Поле
     - Описание
   * - iban
     - Номер счета
   * - accountName
     - Наименование счета, обычно ФИО
   * - ps
     - План счетов по ГК
   * - system
     - КОД АБС
   * - cur
     - Валюта
	 
Получить Скан ДБЗ
_______________________________________________________________


GET http://{$abs_get_pdf_url}?dbz_num=KD0000000&dbz_dt=2020-01-01&iinbin=000000000000


.. list-table:: Описание полей
   :header-rows: 1

   * - Поле
     - Описание
   * - dbz_num
     - Номер ДБЗ
   * - dbz_dt
     - Дата ДБЗ в формате ГГГГ.ММ.ДД
   * - iinbin
     - ИИН или БИН клиента

Успешный Ответ:

.. code-block:: text

	Status 200
	Content-Type: application/pdf
	Content-Disposition: attachment; filename="Имяфайла.pdf"		
	RAW данные в формате PDF,TIFF


Неуспешный Ответ:

.. code-block:: text

	Status 404
	
