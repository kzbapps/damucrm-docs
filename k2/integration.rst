Описание интеграции
==================================================================================================

Данный раздел описывает интеграции с системой Картотека обременений(К2)

Сервисы для приема
---------------------------

Сервис приема сведений о просроченной задолженности
_______________________________________________________________

Запрос

.. code-block:: text

POST https://{$k2host}/restapi/services/k2loan_from_eko


.. code-block:: json

     [
          {
			"iban": "KZ000000000000000000",
			"cur": "KZT",
			"debt": 2000000,
			"fullname": "Тестовый Тест Тестович",
			"contract_number": "KD0000000001",
			"dbz_contract_number": "KD0000000001",
			"dbz_dt": "2014-02-08",
			"dep_id": 555,
			"id": 666,
			"iinbin": "000000000000",
			"overdue_days": 90,
			"system": "way4"          
          }
          ,
          {
          
          }
          ,
          {
          
          }
     ]


Ответ:

.. code-block:: json

     {
          "error_text":"",
          "error_code":0
     }



"error_code":0 - успешный ответ


Сервис приема статусов входящего платежного требования
_______________________________________________________________

POST https://{$k2host}/restapi/services/k2req_status_from_eko

.. code-block:: json

     {
          "reference": "PTP00000000001",
          "status_code": "PC1"
     }


.. list-table:: Описание полей
   :header-rows: 1

   * - Поле
     - Описание
   * - reference
     - Референс платежного требования
   * - status_code
     - Статус подтверждения      

.. list-table:: Описание статуса
   :header-rows: 1

   * - Описание статуса
     - код статуса
   * - Принята банком
     - PC1
   * - Принята в картотеку банка
     - PC3
 
Ответ:

.. code-block:: json
     
     {
          "error_text":"",
          "error_code":0
     }


«error_code»:0 - успешный ответ


Сервис приема отзыва входящего платежного требования
_______________________________________________________________

Запрос:

POST https://{$k2host}/restapi/services/k2req_refuse_from_eko


.. code-block:: json

     {
          "reference": "PTP00000000001",
          "reason_code": "01"
     }

reason_code - причина возврата. смотрите с разделе Документы -> Причины отзывов.
     
Ответ:

.. code-block:: json
     
     {
          "error_text":"",
          "error_code":0
     }


«error_code»:0 - успешный ответ


Сервисы , которые вызываем в АБС
------------------------------------------------------

Получить информацию по клиенту
_______________________________________________________________


GET https://{$abs_get_cli_url}?iinbin=000000000000

.. list-table:: Описание полей
   :header-rows: 1

   * - Поле
     - Описание
   * - iinbin
     - ИИН или БИН клиента

Ответ:

.. code-block:: json
     
     {
          "error_text":"",
          "error_code":0,
          "iinbin": "000000000000",
          "fullname": "850210301899",
          "sectecon": 9,
          "residfl": 1
     }

«error_code»:0 - успешный ответ     
     
Список счетов по клиенту
_______________________________________________________________


GET https://{$abs_get_acc_url}?iinbin=000000000000

.. list-table:: Статусы
   :header-rows: 1

   * - Поле
     - Описание
   * - iinbin
     - ИИН или БИН клиента

Ответ:

.. code-block:: json
     
     {
          "error_text":"",
          "error_code":0,
          "ibans":
          [          
               {
                    "iban":"KZ000000000000000000",
                    "accountName":"Наименование счета, обычно ФИО",               
                    "ps": "2204191",
                    "system": "way4",
                    "cur": "KZT"
               }
          ]

     }
     
«error_code»:0 - успешный ответ     

.. list-table:: Описание полей
   :header-rows: 1

   * - Поле
     - Описание
   * - iban
     - Номер счета
   * - accountName
     - Наименование счета, обычно ФИО
   * - ps
     - План счетов по ГК
   * - system
     - КОД АБС
   * - cur
     - Валюта

Получить выписку по счету на Дату
_______________________________________________________________
      
Достаточно вернуть 1 строку выписки по предоставлению кредита:

GET https://{$abs_get_acc_stmt_dt_url}?dep_id=555&id=666&dt=2020-01-01

.. list-table:: Описание полей
   :header-rows: 1

   * - Поле
     - Описание
   * - dep_id/id
     - DEP_ID/ID договора в АБС колвир
   * - dt
     - Дата в формате ГГГГ.ММ.ДД

Ответ:

.. code-block:: json

     {
          "error_text": "",
          "error_code": 0,
          "stmt": [
               {
                    "purpose": "Предоставление кредита по договору",
                    "amount": 900000,
                    "cur": "KZT",
                    "DC": "D",
                    "out_bal": 900000
               }
          ]
     }


.. list-table:: Описание полей
   :header-rows: 1
     
   * - Поле
     - Описание
   * - purpose
     - Назначение платежа
   * - amount
     - Сумма
   * - cur
     - Код валюты
   * - DC
     - D -дебет, C - кредит
   * - out_bal
     - Исходящий остаток
     
«error_code»:0 - успешный ответ     

.. list-table:: Описание полей
   :header-rows: 1

   * - Поле
     - Описание
   * - iban
     - Номер счета
   * - accountName
     - Наименование счета, обычно ФИО
   * - ps
     - План счетов по ГК
   * - system
     - КОД АБС
   * - cur
     - Валюта
      
Получить Скан ДБЗ
_______________________________________________________________


GET https://{$abs_get_pdf_url}?dbz_num=KD0000000&dbz_dt=2020-01-01&iinbin=000000000000


.. list-table:: Описание полей
   :header-rows: 1

   * - Поле
     - Описание
   * - dbz_num
     - Номер ДБЗ
   * - dbz_dt
     - Дата ДБЗ в формате ГГГГ.ММ.ДД
   * - iinbin
     - ИИН или БИН клиента

Успешный Ответ:

.. code-block:: text

     Status 200
     Content-Type: application/pdf
     Content-Disposition: attachment; filename="Имяфайла.pdf"          
     RAW данные в формате PDF,TIFF


Неуспешный Ответ:

.. code-block:: text

     Status 404

Регистрация ПТ в информационной системе банка
_______________________________________________________________     

POST https://{$abs_reg_pt_url}

.. code-block:: json

     {
          "refer": "PTP0000000000001",
          "accept_dt": "2021-01-05",
          "doc_num": "16",
          "doc_at": "2021-01-04",
          "iinbin": "ИИН/БИН клиента",
          "acc_fullname": "Тестовый тест тестович",
          "ben_fullname": "АО \"KASPI BANK\"",
          "ben_bin": "971240001315",
          "ben_iban": "KZ12722R00000000000",
          "ben_kbe": "14",
          "amount": 2000000,
          "cur": "KZT",
          "knp": "423",
          "dbz_num": "R0000-001",
          "dbz_dt": "2014-02-08",
          "purpose": "Безакцептное погашение задолженности заемщика (Тестовый тест тестович) по Договору банковского займа №R0000-001 от 08.02.2014г. ,  в соответствии со ст. 32 Закона РК №11-VI от 26.07.2016г. \"О платежах и платежных системах\".",
          "head":"Руководителев Руководитель Руководителулы",
          "account":"Главный Бухгалер Петрович"          
     }

.. list-table:: Описание полей
     :header-rows: 1     

     * - Поле
       - Описание
     * - refer
       - Уникальный Референс ПТ
     * - accept_dt
       - Дата приема ПТ в формате ГГГГ.ММ.ДД
     * - doc_num
       - Номер документа
     * - accept_dt
       - Дата ПТ в формате ГГГГ.ММ.ДД	   
     * - iinbin
       - ИИН или БИН клиента 
     * - acc_fullname
       - Наименование счета
     * - ben_fullname
       - Получатель
     * - ben_bin
       - БИН получателя
     * - ben_iban
       - Номер счета получателя
     * - ben_kbe
       - КБе
     * - amount
       - Сумма ПТ
     * - cur
       - Код валюты
     * - knp
       - Код назначения платежа
     * - dbz_num
       - Номер ДБЗ
     * - dbz_dt
       - Дата ДБЗ в формате ГГГГ.ММ.ДД
     * - purpose
       - Назначение платежа
     * - head
       - Руководитель
     * - account
       - Бухгалтер
      
Ответ

.. code-block:: json
     
     {
          "error_text":"",
          "error_code":0
     }


Отзыв ПТ в информационной системе банка
_______________________________________________________________     

POST https://{$abs_refuse_pt_url}

.. code-block:: json

     {
          "refer": "PTP0000000000001",
          "reason_code": "01"
     }     
     

reason_code - причина отзыва. смотрите с разделе Документы -> Причины отзывов.



Ответ

.. code-block:: json
     
     {
          "error_text":"",
          "error_code":0
     }
     

Возврат ПТ в информационной системе банка
_______________________________________________________________     


POST https://{$abs_return_pt_url}

.. code-block:: json

     {
          "refer": "PTP0000000000001",
          "reason_code": "99"
     }     
     

reason_code - причина возврата. смотрите с разделе Документы -> Причины отзывов.



Ответ

.. code-block:: json
     
     {
          "error_text":"",
          "error_code":0
     }
	 
	 
Получение актуальной задолженности по кредиту из Colvir
_______________________________________________________________     


POST https://{$colvir_get_loan_debt}

.. code-block:: json

     {
          "dep_id": 2,
          "id": 1001
     }     
     
dep_id/id - Primary Key договора (L_DEA)

Ответ

.. code-block:: json
     
     {
          "error_text":"",
          "error_code":0
		  "debt":100000
     }	 
	 
	 
Получение актуальной задолженности по кредиту из Way4
_______________________________________________________________     


POST https://{$way4_get_loan_debt}

.. code-block:: json

     {
          "contract_number": "KZ000000000000000000"
     }     
     
contract_number - Уникальный номер контракта.


Ответ

.. code-block:: json
     
     {
          "error_text":"",
          "error_code":0
		  "debt":100000
     }


Получение списка платежных требований из АБС по фильтру
_______________________________________________________________     


POST https://{$get_all_pt_from_abs}

.. code-block:: json

     {
          "page ": 1,
		  "perpage":"2",
		  "ben_bin":"000000000000",
		  "doc_at1":"2021-05-01",
		  "doc_at2":"2021-05-01",
		  "iinbin":"111111111111"
     }     
     
.. list-table:: Описание полей
     :header-rows: 1     

     * - Поле
       - Описание
     * - page
       - Номер страницы от 1
     * - perpage
       - Строк на странице, например, 25 страниц. В oracle " OFFSET ? ROWS FETCH NEXT ? ROWS ONLY", в Postgres "limit ? offset ?"
     * - ben_bin
       - Необязательный Фильтр БИН корреспондента
     * - doc_at1
       - Необязательный Фильтр дата документа с
     * - doc_at2
       - Необязательный Фильтр дата документа по
     * - iinbin
       - Необязательный Фильтр по ИИН клиента
   

Ответ

.. code-block:: json
     
	[
		"all_count":1000,
		{
			 "refer": "PTP0000000000001",
			 "accept_dt": "2021-01-05",
			 "doc_num": "16",
			 "doc_at": "2021-01-04",
			 "iinbin": "ИИН/БИН клиента",
			 "acc_fullname": "Тестовый тест тестович",
			 "ben_fullname": "АО \"KASPI BANK\"",
			 "ben_bin": "971240001315",
			 "ben_iban": "KZ12722R00000000000",
			 "ben_kbe": "14",
			 "amount": 2000000,
			 "cur": "KZT",
			 "knp": "423",
			 "dbz_num": "R0000-001",
			 "dbz_dt": "2014-02-08",
			 "purpose": "Безакцептное погашение задолженности заемщика (Тестовый тест тестович) по Договору банковского займа №R0000-001 от 08.02.2014г. ,  в соответствии со ст. 32 Закона РК №11-VI от 26.07.2016г. \"О платежах и платежных системах\".",
			 "head":"Руководителев Руководитель Руководителулы",
			 "account":"Главный Бухгалер Петрович"
		},
		{
		},
		{
		}

	]


.. list-table:: Описание полей
     :header-rows: 1     

     * - Поле
       - Описание
     * - refer
       - Уникальный Референс ПТ
     * - accept_dt
       - Дата приема ПТ в формате ГГГГ.ММ.ДД
     * - doc_num
       - Номер документа
     * - accept_dt
       - Дата ПТ в формате ГГГГ.ММ.ДД	   
     * - iinbin
       - ИИН или БИН клиента 
     * - acc_fullname
       - Наименование счета
     * - ben_fullname
       - Получатель
     * - ben_bin
       - БИН получателя
     * - ben_iban
       - Номер счета получателя
     * - ben_kbe
       - КБе
     * - amount
       - Сумма ПТ
     * - cur
       - Код валюты
     * - knp
       - Код назначения платежа
     * - dbz_num
       - Номер ДБЗ
     * - dbz_dt
       - Дата ДБЗ в формате ГГГГ.ММ.ДД
     * - purpose
       - Назначение платежа
     * - head
       - Руководитель
     * - account
       - Бухгалтер
     * - all_count
       - Количество записей без фильтра. Для отражения постраничного вывода.
